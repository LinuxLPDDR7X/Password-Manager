<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Manager - Sign in with Google</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Secure password manager with Google Sign-In">
    <meta name="theme-color" content="#1976d2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Password Manager">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
/* Material Design CSS - Same as before but with Google Sign-In additions */
:root {
  --primary-color: #1976d2;
  --primary-dark: #1565c0;
  --primary-light: #42a5f5;
  --accent-color: #03dac6;
  
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --bg-card: #ffffff;
  --text-primary: #212121;
  --text-secondary: #757575;
  --text-hint: #9e9e9e;
  --border-color: #e0e0e0;
  --shadow-color: rgba(0, 0, 0, 0.12);
  --input-bg: #ffffff;
  --input-border: #e0e0e0;
  --input-focus: var(--primary-color);
  
  --font-family: 'Roboto', sans-serif;
  --font-size-base: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-2xl: 1.5rem;
  
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  
  --radius-md: 8px;
  --radius-lg: 12px;
  
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
  
  --transition-fast: 150ms ease;
  --transition-normal: 250ms ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-family);
  font-size: var(--font-size-base);
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--bg-primary);
  transition: background-color var(--transition-normal), color var(--transition-normal);
}

.app-container {
  min-height: 100vh;
  background-color: var(--bg-secondary);
}

/* Header */
.app-header {
  background-color: var(--primary-color);
  color: white;
  box-shadow: var(--shadow-md);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-md) var(--spacing-xl);
  max-width: 1200px;
  margin: 0 auto;
}

.header-left {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.header-icon {
  font-size: 2rem;
}

.app-title {
  font-size: var(--font-size-2xl);
  font-weight: 500;
  margin: 0;
}

.header-right {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

/* Main Content */
.main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--spacing-xl);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

/* Cards */
.card {
  background-color: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: all var(--transition-normal);
}

.card-header {
  padding: var(--spacing-lg) var(--spacing-xl);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-content {
  padding: var(--spacing-xl);
}

.section-title {
  font-size: var(--font-size-xl);
  font-weight: 500;
  color: var(--text-primary);
  margin: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  border: none;
  border-radius: var(--radius-md);
  font-family: var(--font-family);
  font-size: var(--font-size-base);
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  min-height: 48px;
  outline: none;
}

.btn-primary {
  background-color: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background-color: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-google {
  background-color: #4285f4;
  color: white;
  width: 100%;
  justify-content: center;
  font-size: var(--font-size-lg);
  padding: var(--spacing-lg) var(--spacing-xl);
  margin-bottom: var(--spacing-lg);
}

.btn-google:hover {
  background-color: #3367d6;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background-color: transparent;
  color: var(--text-secondary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
}

.btn-danger {
  background-color: #f44336;
  color: white;
}

.btn-danger:hover {
  background-color: #d32f2f;
}

.icon-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border: none;
  border-radius: 50%;
  background-color: transparent;
  color: currentColor;
  cursor: pointer;
  transition: all var(--transition-fast);
  outline: none;
}

.icon-button:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

/* Forms */
.form-field {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.field-label {
  font-size: var(--font-size-base);
  font-weight: 500;
  color: var(--text-primary);
}

.form-input,
.form-select {
  padding: var(--spacing-md) var(--spacing-lg);
  border: 2px solid var(--input-border);
  border-radius: var(--radius-md);
  font-family: var(--font-family);
  font-size: var(--font-size-base);
  background-color: var(--input-bg);
  color: var(--text-primary);
  transition: all var(--transition-fast);
  outline: none;
  min-height: 56px;
}

.form-input:focus,
.form-select:focus {
  border-color: var(--input-focus);
  box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
}

.form-actions {
  display: flex;
  gap: var(--spacing-md);
  justify-content: flex-end;
  margin-top: var(--spacing-md);
}

/* Password Items */
.passwords-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.password-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
  padding: var(--spacing-lg);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background-color: var(--bg-card);
  transition: all var(--transition-fast);
}

.password-item:hover {
  border-color: var(--primary-light);
  box-shadow: var(--shadow-sm);
}

.password-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background-color: var(--primary-color);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 500;
  font-size: var(--font-size-lg);
  flex-shrink: 0;
}

.password-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  min-width: 0;
}

.password-service {
  font-size: var(--font-size-lg);
  font-weight: 500;
  color: var(--text-primary);
}

.password-username {
  color: var(--text-secondary);
  font-size: var(--font-size-base);
}

.password-actions {
  display: flex;
  gap: var(--spacing-sm);
  flex-shrink: 0;
}

/* Login Screen */
.login-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: var(--spacing-xl);
}

.login-card {
  width: 100%;
  max-width: 400px;
}

.login-header {
  text-align: center;
  margin-bottom: var(--spacing-xl);
}

.login-icon {
  width: 80px;
  height: 80px;
  background-color: var(--primary-color);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto var(--spacing-lg) auto;
}

.login-icon .material-icons {
  font-size: 2.5rem;
  color: white;
}

.google-logo {
  width: 24px;
  height: 24px;
  margin-right: var(--spacing-sm);
}

.divider {
  display: flex;
  align-items: center;
  margin: var(--spacing-xl) 0;
  text-transform: uppercase;
  color: var(--text-hint);
  font-size: 0.875rem;
  font-weight: 500;
}

.divider::before,
.divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background-color: var(--border-color);
}

.divider::before {
  margin-right: var(--spacing-lg);
}

.divider::after {
  margin-left: var(--spacing-lg);
}

/* Toast */
.toast {
  position: fixed;
  bottom: var(--spacing-xl);
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background-color: var(--primary-color);
  color: white;
  padding: var(--spacing-md) var(--spacing-xl);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-weight: 500;
  z-index: 1100;
  opacity: 0;
  transition: all var(--transition-normal);
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* User info display */
.user-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.9rem;
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 500;
}

/* Loading spinner */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .header-content {
    padding: var(--spacing-md);
  }
  
  .main-content {
    padding: var(--spacing-md);
  }
  
  .password-item {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .password-actions {
    align-self: stretch;
    justify-content: space-between;
  }
  
  .user-info {
    display: none;
  }
}
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <div class="card login-card">
                <div class="login-header">
                    <div class="login-icon">
                        <span class="material-icons">lock</span>
                    </div>
                    <h2>Password Manager</h2>
                    <p>Secure your passwords with Google authentication</p>
                </div>
                
                <div class="card-content">
                    <!-- Google Sign-In Button -->
                    <a href="/google_login" class="btn btn-google">
                        <svg class="google-logo" viewBox="0 0 24 24">
                            <path fill="white" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="white" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="white" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="white" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Sign in with Google
                    </a>
                    
                    <div class="divider">or</div>
                    
                    <!-- Regular username/password form -->
                    <form id="loginForm">
                        <div class="form-field">
                            <label for="username" class="field-label">Username</label>
                            <input type="text" id="username" class="form-input" required>
                        </div>
                        
                        <div class="form-field">
                            <label for="password" class="field-label">Password</label>
                            <input type="password" id="password" class="form-input" required>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                Sign In
                            </button>
                        </div>
                    </form>
                    
                    <div style="text-align: center; margin-top: var(--spacing-lg); color: var(--text-secondary); font-size: 0.9rem;">
                        <p>New users will automatically get an account created</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App (Hidden initially) -->
        <div id="mainApp" style="display: none;">
            <!-- Header -->
            <header class="app-header">
                <div class="header-content">
                    <div class="header-left">
                        <span class="material-icons header-icon">lock</span>
                        <h1 class="app-title">Password Manager</h1>
                    </div>
                    <div class="header-right">
                        <div id="userInfo" class="user-info">
                            <div id="userAvatar" class="user-avatar"></div>
                            <span id="userEmail"></span>
                        </div>
                        <button class="icon-button" id="logoutBtn" title="Logout">
                            <span class="material-icons">logout</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Add Password Section -->
                <section class="add-password-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="section-title">Add New Password</h2>
                        </div>
                        <div class="card-content">
                            <form id="passwordForm">
                                <div class="form-field">
                                    <label for="serviceName" class="field-label">Service Name *</label>
                                    <input type="text" id="serviceName" class="form-input" required>
                                </div>
                                
                                <div class="form-field">
                                    <label for="accountType" class="field-label">Account Type</label>
                                    <select id="accountType" class="form-select">
                                        <option value="custom">Custom</option>
                                        <option value="google">Google</option>
                                        <option value="microsoft">Microsoft</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="github">GitHub</option>
                                        <option value="netflix">Netflix</option>
                                        <option value="amazon">Amazon</option>
                                    </select>
                                </div>
                                
                                <div class="form-field">
                                    <label for="usernameField" class="field-label">Username/Email *</label>
                                    <input type="text" id="usernameField" class="form-input" required>
                                </div>
                                
                                <div class="form-field">
                                    <label for="passwordField" class="field-label">Password *</label>
                                    <input type="password" id="passwordField" class="form-input" required>
                                </div>
                                
                                <div class="form-field">
                                    <label for="urlField" class="field-label">Website URL</label>
                                    <input type="url" id="urlField" class="form-input" placeholder="https://example.com">
                                </div>
                                
                                <div class="form-field">
                                    <label for="notesField" class="field-label">Notes</label>
                                    <input type="text" id="notesField" class="form-input" placeholder="Additional notes">
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" id="clearForm" class="btn btn-secondary">
                                        <span class="material-icons">clear</span>
                                        Clear
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons">save</span>
                                        Save Password
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Saved Passwords Section -->
                <section class="saved-passwords-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="section-title">Saved Passwords</h2>
                            <div class="password-count">
                                <span id="passwordCount">0</span> passwords
                            </div>
                        </div>
                        <div class="card-content">
                            <div id="passwordsList" class="passwords-list">
                                <div class="empty-state" id="emptyState">
                                    <span class="material-icons" style="font-size: 4rem; opacity: 0.5;">lock_open</span>
                                    <h3>No passwords saved yet</h3>
                                    <p>Add your first password to get started</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Success Toast -->
        <div class="toast" id="successToast">
            <span class="material-icons">check_circle</span>
            <span id="toastMessage">Action completed successfully!</span>
        </div>
    </div>

    <script>
/**
 * Password Manager with Google Authentication
 * Integrates with Google OAuth and PostgreSQL backend
 */

class PasswordManagerGoogle {
    constructor() {
        this.apiUrl = window.location.origin + '/api';
        this.authToken = null;
        this.currentUser = null;
        this.userEmail = null;
        this.passwords = [];

        this.init();
    }

    init() {
        this.setupEventListeners();
        this.checkAuthentication();
        this.handleAuthCallback();
    }

    setupEventListeners() {
        // Regular login form
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleRegularLogin();
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            this.logout();
        });

        // Password form
        document.getElementById('passwordForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addPassword();
        });

        // Clear form
        document.getElementById('clearForm').addEventListener('click', () => {
            this.clearForm();
        });
    }

    handleAuthCallback() {
        // Check if we have token and user info from Google OAuth callback
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const email = urlParams.get('email');
        const name = urlParams.get('name');

        if (token && email) {
            this.authToken = token;
            this.userEmail = email;
            this.currentUser = name;
            
            // Store in localStorage for persistence
            localStorage.setItem('authToken', this.authToken);
            localStorage.setItem('userEmail', this.userEmail);
            localStorage.setItem('currentUser', this.currentUser);
            
            // Clean up URL
            window.history.replaceState({}, document.title, window.location.pathname);
            
            this.showMainApp();
            this.loadPasswords();
            this.showToast(`Welcome ${name}! Signed in with Google.`);
        }
    }

    checkAuthentication() {
        // Check localStorage for existing auth
        this.authToken = localStorage.getItem('authToken');
        this.userEmail = localStorage.getItem('userEmail');
        this.currentUser = localStorage.getItem('currentUser');

        if (this.authToken && this.userEmail) {
            this.showMainApp();
            this.loadPasswords();
        } else {
            this.showLoginScreen();
        }
    }

    async handleRegularLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) {
            this.showToast('Please fill in all fields', 'error');
            return;
        }

        try {
            // Try login first
            let response = await fetch(`${this.apiUrl}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    master_password: password
                })
            });

            // If login fails, try register
            if (!response.ok) {
                response = await fetch(`${this.apiUrl}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        master_password: password
                    })
                });
            }

            const data = await response.json();

            if (response.ok) {
                this.authToken = data.token;
                this.currentUser = username;
                this.userEmail = username; // Use username as email for regular accounts
                
                localStorage.setItem('authToken', this.authToken);
                localStorage.setItem('userEmail', this.userEmail);
                localStorage.setItem('currentUser', this.currentUser);
                
                this.showMainApp();
                this.loadPasswords();
                this.showToast('Successfully signed in!');
            } else {
                this.showToast(data.error || 'Authentication failed', 'error');
            }
        } catch (error) {
            console.error('Auth error:', error);
            this.showToast('Connection error. Please try again.', 'error');
        }
    }

    logout() {
        this.authToken = null;
        this.currentUser = null;
        this.userEmail = null;
        this.passwords = [];
        
        localStorage.removeItem('authToken');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('currentUser');
        
        this.showLoginScreen();
        this.showToast('Signed out successfully');
    }

    showLoginScreen() {
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    }

    showMainApp() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        
        // Update user info display
        document.getElementById('userEmail').textContent = this.userEmail;
        const avatar = document.getElementById('userAvatar');
        avatar.textContent = this.currentUser ? this.currentUser.charAt(0).toUpperCase() : 'U';
    }

    async loadPasswords() {
        try {
            const response = await fetch(`${this.apiUrl}/passwords`, {
                headers: {
                    'Authorization': `Bearer ${this.authToken}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                this.passwords = data.passwords || [];
                this.renderPasswordsList();
                this.updatePasswordCount();
            } else if (response.status === 401) {
                this.logout();
            } else {
                this.showToast('Failed to load passwords', 'error');
            }
        } catch (error) {
            console.error('Load passwords error:', error);
            this.showToast('Connection error', 'error');
        }
    }

    async addPassword() {
        const serviceName = document.getElementById('serviceName').value.trim();
        const accountType = document.getElementById('accountType').value;
        const username = document.getElementById('usernameField').value.trim();
        const password = document.getElementById('passwordField').value;
        const url = document.getElementById('urlField').value.trim();
        const notes = document.getElementById('notesField').value.trim();

        if (!serviceName || !username || !password) {
            this.showToast('Please fill in all required fields', 'error');
            return;
        }

        try {
            const response = await fetch(`${this.apiUrl}/passwords`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.authToken}`
                },
                body: JSON.stringify({
                    service_name: serviceName,
                    account_type: accountType,
                    username: username,
                    password: password,
                    url: url || null,
                    notes: notes || null
                })
            });

            if (response.ok) {
                this.showToast('Password saved successfully!');
                this.clearForm();
                this.loadPasswords();
            } else if (response.status === 401) {
                this.logout();
            } else {
                const data = await response.json();
                this.showToast(data.error || 'Failed to save password', 'error');
            }
        } catch (error) {
            console.error('Add password error:', error);
            this.showToast('Connection error', 'error');
        }
    }

    async deletePassword(id) {
        if (!confirm('Are you sure you want to delete this password?')) {
            return;
        }

        try {
            const response = await fetch(`${this.apiUrl}/passwords/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${this.authToken}`
                }
            });

            if (response.ok) {
                this.showToast('Password deleted successfully!');
                this.loadPasswords();
            } else if (response.status === 401) {
                this.logout();
            } else {
                this.showToast('Failed to delete password', 'error');
            }
        } catch (error) {
            console.error('Delete password error:', error);
            this.showToast('Connection error', 'error');
        }
    }

    async copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            this.showToast('Copied to clipboard!');
        } catch (error) {
            console.error('Copy error:', error);
            this.showToast('Failed to copy', 'error');
        }
    }

    renderPasswordsList() {
        const passwordsList = document.getElementById('passwordsList');
        const emptyState = document.getElementById('emptyState');

        if (this.passwords.length === 0) {
            passwordsList.innerHTML = '';
            passwordsList.appendChild(emptyState);
            return;
        }

        // Remove empty state
        if (emptyState.parentNode === passwordsList) {
            passwordsList.removeChild(emptyState);
        }

        passwordsList.innerHTML = this.passwords.map(password => {
            const icon = this.getServiceIcon(password.service_name, password.account_type);
            const urlLink = password.url ? 
                `<div><a href="${password.url}" target="_blank" style="color: var(--primary-color); text-decoration: none; font-size: 0.9rem;">${password.url}</a></div>` : '';
            const notesText = password.notes ? 
                `<div style="color: var(--text-hint); font-size: 0.9rem;">${password.notes}</div>` : '';

            return `
                <div class="password-item">
                    <div class="password-icon">${icon}</div>
                    <div class="password-details">
                        <div class="password-service">${password.service_name}</div>
                        <div class="password-username">${password.username}</div>
                        ${urlLink}
                        ${notesText}
                    </div>
                    <div class="password-actions">
                        <button class="icon-button" onclick="passwordManager.copyToClipboard('${password.username}')" title="Copy Username">
                            <span class="material-icons">person</span>
                        </button>
                        <button class="icon-button" onclick="passwordManager.copyToClipboard('***')" title="Copy Password">
                            <span class="material-icons">content_copy</span>
                        </button>
                        <button class="icon-button" onclick="passwordManager.deletePassword(${password.id})" title="Delete Password">
                            <span class="material-icons">delete</span>
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    getServiceIcon(serviceName, accountType) {
        if (accountType && accountType !== 'custom') {
            return accountType.charAt(0).toUpperCase();
        }
        return serviceName.charAt(0).toUpperCase();
    }

    updatePasswordCount() {
        document.getElementById('passwordCount').textContent = this.passwords.length;
    }

    clearForm() {
        document.getElementById('passwordForm').reset();
    }

    showToast(message, type = 'success') {
        const toast = document.getElementById('successToast');
        const messageElement = document.getElementById('toastMessage');
        const icon = toast.querySelector('.material-icons');
        
        messageElement.textContent = message;
        
        if (type === 'error') {
            icon.textContent = 'error';
            toast.style.backgroundColor = '#f44336';
        } else {
            icon.textContent = 'check_circle';
            toast.style.backgroundColor = 'var(--primary-color)';
        }
        
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
}

// Initialize the password manager when the page loads
let passwordManager;
document.addEventListener('DOMContentLoaded', () => {
    passwordManager = new PasswordManagerGoogle();
});
    </script>
</body>
</html>